Preparing files for fragalysis
------------------------------
The script ``fragalysis-api/fragalysis_api/xcimporter/xcimporter.py`` can be used to prepare bound-state pdb files for upload
to fragalysis. 

Usage:
------
options:  

- `-i`, `--in_dir` :  Input Directory
- `-o`, `--out_dir` : Output Directory
- `-v`, `--validate`: (Optional) Validate the Inputs
- `-m`, `--monomerize`: (Optional) Split the input PDBs into separate chains. E.G If a pdb has A and B chains it will create files pdb_name_A.pdb and pdb_name_B.pdb
- `-t`, `--target`: The name of the output folder to be saved in Output directory
- `-md`, `--metadata`: (Optional) Automatically populated a metadata.csv in the output directory to be fill in.
- `-b`, `--biomol`: (Optional) File path to plain text file that contains an optional header that you would like to be added to PDB files.
- `-r`, `--reference`: (Optional) The name/filepath of the pdb file you which to use as reference (can be PDB ID)
- `-c`, `--covalent`: (Optional) Handle Covalent attachments by extending output .mol file to include covalent attachment atoms. Requires modified smiles strings.


The input directory should contain a bound state pdb file for eacch crystal structure of the target, and a ``_smiles.txt`` file of 
the same filename for each structure containing the smiles string of the bound ligand.  

For example:

```
Mpro
- Mpro-x123.pdb
- Mpro-x123_smiles.txt
```

Example to run:

```
python fragalysis-api/fragalysis_api/xcimporter/xcimporter.py --in_dir=/dls/science/groups/i04-1/fragprep/input/Mpro/ --out_dir=/dls/science/groups/i04-1/fragprep/staging --target Mpro
```

After running, the data will be output in a directory named by the ``target`` option, under the location specified by ``out_dir``

### Preparing metadata for fragalysis upload
Each fragalysis upload requires a .csv file (called `metadata.csv`) to be stored inside the output `aligned`. It should have the following structure:


|<empty>|crystal_name|RealCrystalName|smiles|new_smiles|alternate_name|site_name|pdb_entry|
|---|---|---|---|---|---|---|---|
|1|prot-x0001_0A|prot-x0001|CCCC|<empty>|<empty>|Binding Site|<empty>|
|...|...|...|...|...|...|...|...|

This file will be generated by the api if using the `-md` flag or otherwise can be constructed manually.
- [First Column]: This doesn't have a column name, but just indicates a rownumber, fill 1 to n  
- __crystal_name__ (Required): The name of the crystal as it appear inside the aligned folder. e.g. prot-x0001_0A or prot-x0001_1A
- __RealCrystalName__ (Required): The name of the crystal that the ligand is derived from. e.g. prot-x0001, prot-x0002
- __smiles__ (Required): The SMILES string for the crystal as described in the `aligned/crystal_name/crystal_name_smiles.txt` file
- __new_smiles__ (can be left empty): If the SMILES string is slightly wrong or you want to specify a specific enantiomer to render, declare the new SMILES string here
- __alternate_name__ (can be left empty): If you have a particular title that you would like to render alongside the crystal_name
- __site_name__ (Recommended): This is the most important field. All rows in this column need a value! e.g. Binding Site. So that Fragalysis will know where to cluster the fragments together. This will be rendered alphabetically so if you want to preserved a specific order of sites, prefix the site labels with alphanumeric combinations e.g. "A1 - Binding Site", "B2 - Allosteric Site". If entire column is left empty then fragalysis will cluster ligands together by center of mass and will use uninformative site labels.
- __pdb_entry__ (can be left empty): The PDB code relating to the Crystal.

The rendered table line in plain text will look like this:
```
,crystal_name,RealCrystalName,smiles,new_smiles,alternate_name,site_name,pdb_entry
1,prot-x0001_0A,prot-x0001,CCCC,,,Binding Site,
```